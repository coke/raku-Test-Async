<!doctype html>
<html lang="en">
    <head>
        <title></title>
        <meta charset="UTF-8" />
        <style>
        kbd { font-family: "Droid Sans Mono", "Luxi Mono", "Inconsolata", monospace }
        samp { font-family: "Terminus", "Courier", "Lucida Console", monospace }
        u { text-decoration: none }
        .nested {
            margin-left: 3em;
        }
        aside, u { opacity: 0.7 }
        a[id^="fn-"]:target { background: #ff0 }
        </style>
        <link rel="stylesheet" href="//design.perl6.org/perl.css">
        
        
    </head>
    <body class="pod">
    <div id="___top"></div>
    
    
    
    <nav class="indexgroup">
<table id="TOC">
<caption><h2 id="TOC_Title">Table of Contents</h2></caption>
                           <tr class="toc-level-2"><td class="toc-number">0.1</td><td class="toc-text"><a href="#Str:D_$.FLUNK-message"><code class="pod-code-inline">Str:D $.FLUNK-message</code></a></td></tr>
    <tr class="toc-level-2"><td class="toc-number">0.2</td><td class="toc-text"><a href="#Numeric:D_$.FLUNK-count"><code class="pod-code-inline">Numeric:D $.FLUNK-count</code></a></td></tr>
      <tr class="toc-level-2"><td class="toc-number">0.3</td><td class="toc-text"><a href="#take-FLUNK(--_Str)&gt;"><code class="pod-code-inline">take-FLUNK(--</code> Str)&gt;</a></td></tr>
      <tr class="toc-level-2"><td class="toc-number">0.4</td><td class="toc-text"><a href="#multi_expected-got(Str:D_$expected,_Str:D_$got,_Str_:$exp-sfx,_Str_:$got-sfx_--_Str)&gt;"><code class="pod-code-inline">multi expected-got(Str:D $expected, Str:D $got, Str :$exp-sfx, Str :$got-sfx --</code> Str)&gt;</a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">0.5</td><td class="toc-text"><a href="#multi_expected-got($expected,_$got,_:$gist,_:$quote,_*%c)"><code class="pod-code-inline">multi expected-got($expected, $got, :$gist, :$quote, *%c)</code></a></td></tr>
                      <tr class="toc-level-2"><td class="toc-number">0.6</td><td class="toc-text"><a href="#cmd-settestflunk"><code class="pod-code-inline">cmd-settestflunk</code></a></td></tr>
    <tr class="toc-level-1"><td class="toc-number">1</td><td class="toc-text"><a href="#TEST_TOOLS">TEST TOOLS</a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">1.1</td><td class="toc-text"><a href="#diag_+@msg"><code class="pod-code-inline">diag +@msg</code></a></td></tr>
          <tr class="toc-level-2"><td class="toc-number">1.2</td><td class="toc-text"><a href="#skip-remaining($message,_Bool_:$global?)"><code class="pod-code-inline">skip-remaining($message, Bool :$global?)</code></a></td></tr>
      <tr class="toc-level-2"><td class="toc-number">1.3</td><td class="toc-text"><a href="#todo-remaining(Str:D_$message)"><code class="pod-code-inline">todo-remaining(Str:D $message)</code></a></td></tr>
    <tr class="toc-level-2"><td class="toc-number">1.4</td><td class="toc-text"><a href="#multi_subtest(Pair_$what,_Bool:D_:$async=False,_Bool:D_:$instant=False,_*%plan)"><code class="pod-code-inline">multi subtest(Pair $what, Bool:D :$async=False, Bool:D :$instant=False, *%plan)</code></a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">1.5</td><td class="toc-text"><a href="#multi_subtest(Str:D_$message,_Callable:D_\code,_Bool:D_:$async=False,_Bool:D_:$instant=False,_*%plan)"><code class="pod-code-inline">multi subtest(Str:D $message, Callable:D \code, Bool:D :$async=False, Bool:D :$instant=False, *%plan)</code></a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">1.6</td><td class="toc-text"><a href="#multi_subtest(Callable:D_\code,_Bool:D_:$async=False,_Bool:D_:$instant=False,_*%plan)"><code class="pod-code-inline">multi subtest(Callable:D \code, Bool:D :$async=False, Bool:D :$instant=False, *%plan)</code></a></td></tr>
                                                                               <tr class="toc-level-2"><td class="toc-number">1.7</td><td class="toc-text"><a href="#mutli_is-run(Str()_$code,_%params,_Str:D_$message_=_&quot;&quot;)"><code class="pod-code-inline">mutli is-run(Str() $code, %params, Str:D $message = &quot;&quot;)</code></a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">1.8</td><td class="toc-text"><a href="#multi_is-run(Str()_$code,_Str:D_$message_=_&quot;&quot;,_*%params)"><code class="pod-code-inline">multi is-run(Str() $code, Str:D $message = &quot;&quot;, *%params)</code></a></td></tr>
                             <tr class="toc-level-2"><td class="toc-number">1.9</td><td class="toc-text"><a href="#multi_test-flunks(Str:D_$message,_Bool_:$remaining?)"><code class="pod-code-inline">multi test-flunks(Str:D $message, Bool :$remaining?)</code></a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">1.10</td><td class="toc-text"><a href="#multi_test-flunks($count)"><code class="pod-code-inline">multi test-flunks($count)</code></a></td></tr>
 <tr class="toc-level-2"><td class="toc-number">1.11</td><td class="toc-text"><a href="#multi_test-flunks(Str_$message,_$count)"><code class="pod-code-inline">multi test-flunks(Str $message, $count)</code></a></td></tr>
                       
</table>
</nav>

    <div class="pod-body">
    <section><h1>NAME</h1>
</section>
<p><code>Test::Async::Base</code> – this test bundle contains all the base test tools</p>
<section><h1>SYNOPSIS</h1>
</section>
<pre class="pod-block-code">use Test::Async::Base;
use Test::Async;
plan 1;
pass &quot;Hello world!&quot;;
done-testing</pre>
<section><h1>DESCRIPTION</h1>
</section>
<p>This bundle is supposed to provide same test tools, as the standard Raku <a href="https://docs.raku.org/type/Test"><code>Test</code></a>. So that</p>
<pre class="pod-block-code">use Test::Async;
plan ...;
...; # Do tests
done-testing</pre>
<p>would be the same as:</p>
<pre class="pod-block-code">use Test;
plan ...;
...; # Do tests
done-testing</pre>
<p>For this reason this document only tells about differences between the two.</p>
<p>Test tools resulting in either <em>ok</em> or <em>not ok</em> messages return either <em>True</em> or <em>False</em> depending on test outcome. <code>skip</code> always considered to be successful and thus returns <em>True</em>.</p>
<section><h1>ATTRIBUTES</h1>
</section>
<h2 id="Str:D_$.FLUNK-message"><a class="u" href="#___top" title="go to top of document"><code>Str:D $.FLUNK-message</code></a></h2>
<p>The message set with <code>test-flunks</code>.</p>
<h2 id="Numeric:D_$.FLUNK-count"><a class="u" href="#___top" title="go to top of document"><code>Numeric:D $.FLUNK-count</code></a></h2>
<p>Number of tests expected to flunk. Reduces with each next test completing.</p>
<p>See <code>take-FLUNK</code>.</p>
<section><h1>METHODS</h1>
</section>
<h2 id="take-FLUNK(--_Str)>"><a class="u" href="#___top" title="go to top of document"><code>take-FLUNK(--</code> Str)&gt;</a></h2>
<p>If <code>test-flunks</code> is in effect then method returns its message and decreases <code>$.FLUNK-count</code>.</p>
<h2 id="multi_expected-got(Str:D_$expected,_Str:D_$got,_Str_:$exp-sfx,_Str_:$got-sfx_--_Str)>"><a class="u" href="#___top" title="go to top of document"><code>multi expected-got(Str:D $expected, Str:D $got, Str :$exp-sfx, Str :$got-sfx --</code> Str)&gt;</a></h2>
<h2 id="multi_expected-got($expected,_$got,_:$gist,_:$quote,_*%c)"><a class="u" href="#___top" title="go to top of document"><code>multi expected-got($expected, $got, :$gist, :$quote, *%c)</code></a></h2>
<p>Method produces standardized <em>&quot;expected ... but got ...&quot;</em> messages.</p>
<p>The second candidate is used for non-string values. It stringifies them using <a href="https://github.com/vrurg/raku-Test-Async/blob/v0.0.1/docs/md/Test/Async/Utils.md"><code>Test::Async::Utils</code></a> <code>stringify</code> routine and then passes over to the first candidate for formatting alongside with named parameters captured in <code>%c</code>.</p>
<p>Named parameters:</p>
<ul><li><p><code>:$exp-sfx</code> - suffix for &quot;expected&quot;, a string which will be inserted after it.</p>
</li>
<li><p><code>:$got-sfx</code> – suffix for &quot;got&quot;</p>
</li>
<li><p><code>:$gist</code> - enforces use of method <code>gist</code> to stringify values</p>
</li>
<li><p><code>:$quote</code> - enforces use of quotes around the stringified values</p>
</li>
</ul>
<h2 id="cmd-settestflunk"><a class="u" href="#___top" title="go to top of document"><code>cmd-settestflunk</code></a></h2>
<p>Handler for <code>Event::Cmd::SetTestFlunk</code> defined by this bundle.</p>
<h1 id="TEST_TOOLS"><a class="u" href="#___top" title="go to top of document">TEST TOOLS</a></h1>
<h2 id="diag_+@msg"><a class="u" href="#___top" title="go to top of document"><code>diag +@msg</code></a></h2>
<p>Unlike the standard <a href="https://docs.raku.org/type/Test"><code>Test</code></a> <code>diag</code>, accepts a list too allowing similar usage as with <code>say</code> and <code>note</code>.</p>
<h2 id="skip-remaining($message,_Bool_:$global?)"><a class="u" href="#___top" title="go to top of document"><code>skip-remaining($message, Bool :$global?)</code></a></h2>
<p>Skips all remaining tests in current suite. If <code>$global</code> is set then it&#39;s the same as invoking <code>skip-remaining</code> on all suite parents, including the topmost suite.</p>
<h2 id="todo-remaining(Str:D_$message)"><a class="u" href="#___top" title="go to top of document"><code>todo-remaining(Str:D $message)</code></a></h2>
<p>Mark all remaining tests of the current suite as <em>TODO</em>.</p>
<h2 id="multi_subtest(Pair_$what,_Bool:D_:$async=False,_Bool:D_:$instant=False,_*%plan)"><a class="u" href="#___top" title="go to top of document"><code>multi subtest(Pair $what, Bool:D :$async=False, Bool:D :$instant=False, *%plan)</code></a></h2>
<h2 id="multi_subtest(Str:D_$message,_Callable:D_\code,_Bool:D_:$async=False,_Bool:D_:$instant=False,_*%plan)"><a class="u" href="#___top" title="go to top of document"><code>multi subtest(Str:D $message, Callable:D \code, Bool:D :$async=False, Bool:D :$instant=False, *%plan)</code></a></h2>
<h2 id="multi_subtest(Callable:D_\code,_Bool:D_:$async=False,_Bool:D_:$instant=False,_*%plan)"><a class="u" href="#___top" title="go to top of document"><code>multi subtest(Callable:D \code, Bool:D :$async=False, Bool:D :$instant=False, *%plan)</code></a></h2>
<p>The default <code>subtest</code> behaviour is no different from the one in <a href="https://docs.raku.org/type/Test"><code>Test</code></a>. The difference is that our <code>subtest</code> could be invoked:</p>
<ul><li><p>asynchronously</p>
</li>
<li><p>in random order with other <code>subtest</code>s of the same nesting level</p>
</li>
<li><p>randomly and asynchronously at the same time</p>
</li>
</ul>
<p>The asynchronous invocation means that a <code>subtest</code> will be run in a new dedicated thread. The random invocation means that <code>subtest</code> invocation is postponed until the suite code ends. Then all postponed subtests will be pulled and invoked in a random order.</p>
<p>It is possible to combine both async and random modes which might add even more stress to the code tested.</p>
<p><em>Some more information about <code>Test::Async</code> job management can be found in <a href="https://github.com/vrurg/raku-Test-Async/blob/v0.0.1/docs/md/Test/Async/Manual.md"><code>Test::Async::Manual</code></a>, <a href="https://github.com/vrurg/raku-Test-Async/blob/v0.0.1/docs/md/Test/Async/Hub.md"><code>Test::Async::Hub</code></a>, <a href="https://github.com/vrurg/raku-Test-Async/blob/v0.0.1/docs/md/Test/Async/JobMgr.md"><code>Test::Async::JobMgr</code></a></em></p>
<p>The particular mode of operation is defined either by <code>plan</code> keys <code>parallel</code> or <code>random</code>, or by subtest named parameters <code>async</code> or <code>instant</code>. The named parameters take precedence over plan parameters:</p>
<ul><li><p>if <code>instant</code> is set then <code>plan</code>&#39;s <code>random</code> is ignored</p>
</li>
<li><p>if <code>async</code> is set then <code>plan</code>&#39;s <code>parallel</code> is ignored</p>
</li>
</ul>
<p>For example, let&#39;s assume that our current suite is configured for random execution of subtest. Then</p>
<pre class="pod-block-code">subtest &quot;foo&quot;, :instant, {
    ...
}</pre>
<p>would result in the <code>subtest</code> be invoked right away, where it&#39;s declaration is encountered, without postponing. Similarly, if <code>parallel</code> plan parameter is in effect, <code>:instant</code> will overrule it so it will run right here, right now!</p>
<p>Adding <code>:async</code> named parameter too will invoke the subtest instantly and asynchronously. And this also means that a subtest invoked this way won&#39;t be counted as a job by <a href="https://github.com/vrurg/raku-Test-Async/blob/v0.0.1/docs/md/Test/Async/JobMgr.md"><code>Test::Async::JobMgr</code></a>. In other words, we treat <code>:instant</code> as: <em>bypass any queue, just do it here and now!</em></p>
<p>Another edge case is using <code>:async</code> with <code>random</code>. In this case the subtest will be postponed. But when time to invoke subtests comes this particular one will get his dedicated thread no matter what <code>parallel</code> is set to.</p>
<p>Any other named parameters passed to a <code>subtest</code> is treated as a plan key.</p>
<h2 id="mutli_is-run(Str()_$code,_%params,_Str:D_$message_=_&quot;&quot;)"><a class="u" href="#___top" title="go to top of document"><code>mutli is-run(Str() $code, %params, Str:D $message = &quot;&quot;)</code></a></h2>
<h2 id="multi_is-run(Str()_$code,_Str:D_$message_=_&quot;&quot;,_*%params)"><a class="u" href="#___top" title="go to top of document"><code>multi is-run(Str() $code, Str:D $message = &quot;&quot;, *%params)</code></a></h2>
<p>This test tool is not provided by the standard <a href="https://docs.raku.org/type/Test"><code>Test</code></a> framework, but in slightly different forms it is defined in helper modules included in <a href="https://github.com/rakudo/rakudo/blob/e5ecdc4382d2739a701be7956fad52e897936fea/t/packages/Test/Helpers.pm6#L17">Rakudo</a> and <a href="https://github.com/Raku/roast/blob/7033b07bbbb54a301b3bfd1253e30c5e7cebdfab/packages/Test-Helpers/lib/Test/Util.pm6#L107">roast</a> tests.</p>
<p><code>is-run</code> tests <code>$code</code> by executing it in a child compiler process. In a way, it is like doining:</p>
<pre class="pod-block-code"># echo &quot;$code&quot; | rakudo -</pre>
<p>Takes the following named parameters (<code>%params</code> from the first candidate is passed to the second candidate as a capture):</p>
<ul><li><p><code>:$in</code> – data to be sent to the compiler input</p>
</li>
<li><p><code>:@compiler-args</code> – command line arguments for the compiler process</p>
</li>
<li><p><code>:@args</code> - command line arguments for <code>$code</code></p>
</li>
<li><p><code>:$out?</code> – expected standard output</p>
</li>
<li><p><code>:$err?</code> – expected error output</p>
</li>
<li><p><code>:$exitcode = 0</code> – expected process exit code.</p>
</li>
</ul>
<h2 id="multi_test-flunks(Str:D_$message,_Bool_:$remaining?)"><a class="u" href="#___top" title="go to top of document"><code>multi test-flunks(Str:D $message, Bool :$remaining?)</code></a></h2>
<h2 id="multi_test-flunks($count)"><a class="u" href="#___top" title="go to top of document"><code>multi test-flunks($count)</code></a></h2>
<h2 id="multi_test-flunks(Str_$message,_$count)"><a class="u" href="#___top" title="go to top of document"><code>multi test-flunks(Str $message, $count)</code></a></h2>
<p>This test tool informs the bundle that the following tests are expected to flunk and this is exactly what we expect of them to do! Or we can say that it inverts next <code>$count</code> tests results. It can be considered as a meta-tool as it operates over other test tools.</p>
<p>The primary purpose is to allow testing other test tools. For example, test <em>t/080-is-approx.t</em> uses it to make sure that tests are failing when they have to fail:</p>
<pre class="pod-block-code">test-flunks 2;
is-approx 5, 6;
is-approx 5, 6, &#39;test desc three&#39;;</pre>
<p>Setting <code>$count</code> to <a href="https://docs.raku.org/type/Inf"><code>Inf</code></a> is the same as using <code>:remaining</code> named parameter and means: all remaining tests in the current suite are expected to flunk.</p>
<section><h1>SEE</h1>
<p>ALSO</p>
</section>
<p><a href="https://github.com/vrurg/raku-Test-Async/blob/v0.0.4/docs/md/Test/Async/Manual.md"><code>Test::Async::Manual</code></a>, <a href="https://github.com/vrurg/raku-Test-Async/blob/v0.0.1/docs/md/Test/Async/Decl.md"><code>Test::Async::Decl</code></a>, <a href="https://github.com/vrurg/raku-Test-Async/blob/v0.0.1/docs/md/Test/Async/Utils.md"><code>Test::Async::Utils</code></a>, <a href="https://github.com/vrurg/raku-Test-Async/blob/v0.0.1/docs/md/Test/Async/Event.md"><code>Test::Async::Event</code></a></p>
<section><h1>AUTHOR</h1>
<p>Vadim Belman &lt;vrurg@cpan.org&gt;</p>
</section>

    </div>
    
    
    </body>
</html>

